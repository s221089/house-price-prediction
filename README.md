 {
   "cell_type": "markdown",
   "id": "ed05c9d9",
   "metadata": {
    "papermill": {
     "duration": 0.002219,
     "end_time": "2025-07-24T07:09:30.656912",
     "exception": false,
     "start_time": "2025-07-24T07:09:30.654693",
     "status": "completed"
    },
    "tags": []
   },
   "source": [
    "# 🏡 House Prices - Advanced Regression Techniques\n",
    "\n",
    "このNotebookでは、Kaggleの「House Prices」コンペにおいて、  \n",
    "LightGBMを用いた住宅価格予測モデルを構築し、提出データを作成します。\n",
    "\n",
    "---\n",
    "\n",
    "## 🎯 目的\n",
    "\n",
    "- **住宅価格（SalePrice）を予測**する精度の高いモデルを構築\n",
    "- データの構造を理解し、**前処理・特徴量選択・モデル評価**を丁寧に実施\n",
    "- クロスバリデーションを活用して汎化性能を確認\n",
    "\n",
    "---\n",
    "\n",
    "## 🧠 構成・アプローチ\n",
    "\n",
    "1. **データ前処理**  \n",
    "   - 欠損値補完（カテゴリ型: `'None'`、数値型: `0`）  \n",
    "   - One-hot encoding によるカテゴリ変換（`get_dummies`）\n",
    "\n",
    "2. **目的変数の変換**  \n",
    "   - `SalePrice` を log変換（`np.log1p`）し、正規性とRMSEの安定化を図る\n",
    "\n",
    "3. **外れ値除去**  \n",
    "   - `GrLivArea > 4600` の物件は明らかな高価格帯の外れ値として除外\n",
    "\n",
    "4. **特徴量選択**  \n",
    "   - LightGBMで学習 → 重要度上位40特徴量を選抜し再学習\n",
    "\n",
    "5. **モデル学習 & 予測**  \n",
    "   - LightGBMモデルを使用し、testデータを予測  \n",
    "   - 逆log変換（`np.expm1`）を適用して `SalePrice` を復元\n",
    "\n",
    "6. **提出ファイル生成**  \n",
    "   - `submission.csv` を作成し、Kaggleへ提出\n",
    "\n",
    "7. **クロスバリデーション（任意）**  \n",
    "   - KFoldによるCVでモデルの汎化性能（RMSE）を確認\n",
    "\n",
    "---\n",
    "\n",
    "## 🔧 使用モデル・技術\n",
    "\n",
    "- LightGBM（Gradient Boostingベースの回帰モデル）\n",
    "- 特徴量重要度による変数選択\n",
    "- クロスバリデーション（KFold, 5分割）\n",
    "- 評価指標：RMSE（Root Mean Squared Error）\n",
    "\n",
    "---\n",
    "\n",
    "このNotebookは、基本的な前処理からモデル構築・評価・提出までを一貫して行えるように設計されています。\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "id": "02c21516",
   "metadata": {
    "execution": {
     "iopub.execute_input": "2025-07-24T07:09:30.661176Z",
     "iopub.status.busy": "2025-07-24T07:09:30.660979Z",
     "iopub.status.idle": "2025-07-24T07:09:40.820809Z",
     "shell.execute_reply": "2025-07-24T07:09:40.820229Z"
    },
    "papermill": {
     "duration": 10.163228,
     "end_time": "2025-07-24T07:09:40.822116",
     "exception": false,
     "start_time": "2025-07-24T07:09:30.658888",
     "status": "completed"
    },
    "tags": []
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "from lightgbm import LGBMRegressor\n",
    "from sklearn.metrics import mean_squared_error\n",
    "from sklearn.model_selection import KFold\n",
    "\n",
    "# データ読み込み\n",
    "train_df = pd.read_csv('/kaggle/input/house-prices-advanced-regression-techniques/train.csv')\n",
    "test_df = pd.read_csv('/kaggle/input/house-prices-advanced-regression-techniques/test.csv')\n",
    "\n",
    "# SalePriceを取り出しておく\n",
    "y_train = train_df['SalePrice']\n",
    "\n"
   ]
  },
